---
title: "PublishOptions"
description: "Configure message publishing behavior"
---

`PublishOptions` configures how messages are published, including priority, delay, scheduling, and time-to-live settings.

## Definition

```rust
pub struct PublishOptions {
    pub ttl: Option<Duration>,
    pub priority: Option<u8>,
    pub delay: Option<Duration>,
    pub scheduled_at: Option<OffsetDateTime>,
}
```

## Creating options

Use the builder pattern:

```rust
use broccoli_queue::queue::PublishOptions;
use time::Duration;

let options = PublishOptions::builder()
    .priority(1)
    .delay(Duration::seconds(30))
    .build();
```

## Builder methods

### `.ttl(duration)`

Sets the message time-to-live. Messages not processed within this duration may be discarded.

```rust
use time::Duration;

let options = PublishOptions::builder()
    .ttl(Duration::hours(24))
    .build();
```

**Parameters:**
- `duration`: `time::Duration` - How long the message remains valid

### `.priority(level)`

Sets the message priority level from 1 (highest) to 5 (lowest).

```rust
let options = PublishOptions::builder()
    .priority(1)  // Highest priority
    .build();
```

**Parameters:**
- `level`: `u8` - Priority level (1-5)

**Panics:** If priority is not between 1 and 5.

### `.delay(duration)`

Delays the message by the specified duration before it becomes available for consumption.

```rust
use time::Duration;

let options = PublishOptions::builder()
    .delay(Duration::minutes(5))
    .build();
```

**Parameters:**
- `duration`: `time::Duration` - Delay before message is available

### `.schedule_at(time)`

Schedules the message for a specific time.

```rust
use time::OffsetDateTime;

let future_time = OffsetDateTime::now_utc() + time::Duration::hours(2);

let options = PublishOptions::builder()
    .schedule_at(future_time)
    .build();
```

**Parameters:**
- `time`: `time::OffsetDateTime` - When the message should become available

### `.build()`

Creates the `PublishOptions` instance.

```rust
let options = PublishOptions::builder()
    .priority(2)
    .delay(Duration::seconds(10))
    .build();
```

**Returns:** `PublishOptions`

## Fields

### `ttl`

Time-to-live for the message.

**Type:** `Option<time::Duration>`

### `priority`

Message priority level (1-5, where 1 is highest).

**Type:** `Option<u8>`

### `delay`

Delay before the message becomes available.

**Type:** `Option<time::Duration>`

### `scheduled_at`

Specific time for the message to become available.

**Type:** `Option<time::OffsetDateTime>`

## Examples

### High priority message

```rust
let options = PublishOptions::builder()
    .priority(1)
    .build();

queue.publish("alerts", None, &urgent_alert, Some(options)).await?;
```

### Delayed retry

```rust
let options = PublishOptions::builder()
    .delay(Duration::seconds(30))
    .build();

queue.publish("retries", None, &failed_job, Some(options)).await?;
```

### Scheduled task

```rust
use time::{OffsetDateTime, Duration};

// Schedule for tomorrow at 9 AM
let tomorrow_9am = OffsetDateTime::now_utc()
    .date()
    .next_day()
    .unwrap()
    .with_hms(9, 0, 0)
    .unwrap()
    .assume_utc();

let options = PublishOptions::builder()
    .schedule_at(tomorrow_9am)
    .build();

queue.publish("scheduled_reports", None, &report_job, Some(options)).await?;
```

### Combined options

```rust
let options = PublishOptions::builder()
    .priority(2)                      // Medium-high priority
    .delay(Duration::minutes(5))      // Wait 5 minutes
    .ttl(Duration::hours(1))          // Expire after 1 hour
    .build();

queue.publish("jobs", None, &job, Some(options)).await?;
```

### Default options

Pass `None` for default behavior:

```rust
// No special options - immediate, normal priority, no TTL
queue.publish("jobs", None, &job, None).await?;
```

## Notes

<Note>
Using `delay` or `scheduled_at` requires enabling scheduling in the queue builder with `.enable_scheduling(true)`.
</Note>

<Warning>
For RabbitMQ, message scheduling requires the [delayed-exchange plugin](https://www.rabbitmq.com/blog/2015/04/16/scheduling-messages-with-rabbitmq).
</Warning>
